---
description: 
globs: 
alwaysApply: false
---
# TDD IMPLEMENTATION ENFORCEMENT

> **TL;DR:** This rule enforces mandatory Test-Driven Development (TDD) practices across ALL implementation phases for ALL complexity levels. NO implementation code can be written without following the Red-Green-Refactor cycle.

## ğŸš¨ MANDATORY TDD PROTOCOL

```mermaid
graph TD
    Start["Implementation<br>Request"] --> Block["ğŸš¨ IMPLEMENTATION<br>BLOCKED"]
    Block --> TestFirst{"Has failing<br>test been written?"}
    TestFirst -->|"No"| WriteTest["MANDATORY:<br>Write Failing Test"]
    TestFirst -->|"Yes"| ShowFailure["Show Test<br>Failure Output"]
    
    WriteTest --> ShowFailure
    ShowFailure --> MinImpl["Write MINIMAL<br>Implementation"]
    MinImpl --> RunTest["Run Tests"]
    RunTest --> TestPass{"Tests<br>Passing?"}
    
    TestPass -->|"No"| FixImpl["Fix Implementation<br>(Stay Minimal)"]
    FixImpl --> RunTest
    TestPass -->|"Yes"| Refactor["Refactor<br>(Optional)"]
    Refactor --> Complete["Implementation<br>Allowed"]
    
    style Start fill:#4da6ff,stroke:#0066cc,color:white
    style Block fill:#ff4444,stroke:#cc0000,color:white
    style WriteTest fill:#ff6666,stroke:#ff0000,color:white
    style Complete fill:#44ff44,stroke:#00cc00,color:white
```

## ğŸ”’ IMPLEMENTATION GATE ENFORCEMENT

### LEVEL 1: Quick Bug Fix TDD

```markdown
## TDD Protocol for Level 1 (Quick Fixes)

### MANDATORY STEPS:
1. **ğŸ”´ RED PHASE:**
   - Write smallest possible failing test that reproduces the bug
   - Show test failure output
   - Document the failing behavior

2. **ğŸŸ¢ GREEN PHASE:**
   - Write minimal code to make test pass
   - Verify fix works for the specific issue
   - Run all related tests

3. **ğŸ”µ REFACTOR PHASE:**
   - Clean up implementation if needed
   - Ensure no regressions introduced
   - Update documentation

### ENFORCEMENT CHECKPOINT:
```
ğŸš¨ LEVEL 1 TDD CHECKPOINT
- Failing test written before fix? [YES/NO]
- Test failure output documented? [YES/NO]
- Minimal implementation written? [YES/NO]
- All tests now passing? [YES/NO]
- Refactoring completed (if needed)? [YES/NO]

â›” BLOCKED: If any NO - Return to TDD cycle
âœ… ALLOWED: If all YES - Proceed with documentation
```
```

### LEVEL 2: Simple Enhancement TDD

```markdown
## TDD Protocol for Level 2 (Simple Enhancements)

### MANDATORY STEPS PER SUBTASK:
1. **ğŸ”´ RED PHASE:**
   - Write failing test for each enhancement piece
   - Verify test fails for expected reasons
   - Document expected behavior

2. **ğŸŸ¢ GREEN PHASE:**
   - Implement minimal code to pass tests
   - Verify enhancement works as designed
   - Run full test suite

3. **ğŸ”µ REFACTOR PHASE:**
   - Improve code structure while maintaining tests
   - Extract reusable components
   - Update documentation

### ENFORCEMENT CHECKPOINT:
```
ğŸš¨ LEVEL 2 TDD CHECKPOINT (Per Subtask)
- Failing tests written for subtask? [YES/NO]
- Test failures verified and documented? [YES/NO]
- Minimal implementation completed? [YES/NO]
- All new and existing tests passing? [YES/NO]
- Code refactored for maintainability? [YES/NO]

â›” BLOCKED: If any NO - Return to TDD cycle
âœ… ALLOWED: If all YES - Continue to next subtask
```
```

### LEVEL 3: Intermediate Feature TDD

```markdown
## TDD Protocol for Level 3 (Intermediate Features)

### MANDATORY STEPS PER MODULE/COMPONENT:
1. **ğŸ”´ RED PHASE:**
   - Write comprehensive failing tests for module
   - Include unit, integration, and acceptance tests
   - Verify all tests fail as expected
   - Document test scenarios and expected outcomes

2. **ğŸŸ¢ GREEN PHASE:**
   - Implement minimal code to pass unit tests
   - Build integration between modules
   - Ensure acceptance tests pass
   - Maintain test coverage thresholds

3. **ğŸ”µ REFACTOR PHASE:**
   - Optimize performance while maintaining tests
   - Improve architecture and design patterns
   - Extract shared utilities and components
   - Update comprehensive documentation

### ENFORCEMENT CHECKPOINT:
```
ğŸš¨ LEVEL 3 TDD CHECKPOINT (Per Module)
- Comprehensive test suite written? [YES/NO]
- Unit tests failing appropriately? [YES/NO]
- Integration tests covering module interactions? [YES/NO]
- Acceptance tests validating user stories? [YES/NO]
- Minimal implementation completed? [YES/NO]
- All test categories passing? [YES/NO]
- Code refactored for scalability? [YES/NO]
- Documentation updated? [YES/NO]

â›” BLOCKED: If any NO - Return to TDD cycle
âœ… ALLOWED: If all YES - Continue to next module
```
```

### LEVEL 4: Complex System TDD

```markdown
## TDD Protocol for Level 4 (Complex Systems)

### MANDATORY STEPS PER IMPLEMENTATION PHASE:
1. **ğŸ”´ RED PHASE:**
   - Write exhaustive test suite for system phase
   - Include unit, integration, system, and acceptance tests
   - Cover security, performance, and reliability scenarios
   - Verify comprehensive test failure
   - Document complete test strategy and coverage

2. **ğŸŸ¢ GREEN PHASE:**
   - Implement system phase with test-driven approach
   - Build robust integration between all system components
   - Ensure all test categories pass
   - Maintain enterprise-grade test coverage
   - Validate against architectural requirements

3. **ğŸ”µ REFACTOR PHASE:**
   - Optimize for enterprise performance and scalability
   - Refine system architecture while maintaining tests
   - Extract reusable frameworks and libraries
   - Create comprehensive technical documentation
   - Ensure maintainability and extensibility

### ENFORCEMENT CHECKPOINT:
```
ğŸš¨ LEVEL 4 TDD CHECKPOINT (Per Phase)
- Exhaustive test suite covering all scenarios? [YES/NO]
- Unit tests for all system components? [YES/NO]
- Integration tests for component interactions? [YES/NO]
- System tests for end-to-end workflows? [YES/NO]
- Performance tests meeting requirements? [YES/NO]
- Security tests validating threat model? [YES/NO]
- Acceptance tests validating business requirements? [YES/NO]
- Enterprise implementation completed? [YES/NO]
- All test categories passing? [YES/NO]
- System refactored for enterprise standards? [YES/NO]
- Comprehensive documentation completed? [YES/NO]

â›” BLOCKED: If any NO - Return to TDD cycle
âœ… ALLOWED: If all YES - Continue to next phase
```
```

## ğŸ“‹ TDD INTEGRATION WITH EXISTING WORKFLOWS

### Integration Points

```mermaid
graph TD
    ExistingWorkflow["Existing Implementation<br>Workflow"] --> TDDGate["ğŸš¨ TDD ENFORCEMENT<br>GATE"]
    TDDGate --> RedPhase["ğŸ”´ RED PHASE<br>Write Failing Tests"]
    RedPhase --> GreenPhase["ğŸŸ¢ GREEN PHASE<br>Minimal Implementation"]
    GreenPhase --> BluePhase["ğŸ”µ REFACTOR PHASE<br>Improve Code"]
    BluePhase --> Continue["Continue Existing<br>Workflow"]
    
    style TDDGate fill:#ff4444,stroke:#cc0000,color:white
    style RedPhase fill:#ff6666,stroke:#ff0000,color:white
    style GreenPhase fill:#66ff66,stroke:#00ff00,color:white
    style BluePhase fill:#6666ff,stroke:#0000ff,color:white
```

### Modified Implementation Templates

#### Level 1 Modified Template
```markdown
## ğŸ”§ TDD FIX: [Issue Name]

### ğŸ”´ RED PHASE
**Failing Test:**
```typescript
describe('Bug Fix: [Issue Name]', () => {
  it('should [expected behavior]', () => {
    // Arrange
    const [setup] = setupTestCase();
    
    // Act
    const result = [actionThatShouldWork]();
    
    // Assert
    expect(result).toBe([expectedValue]);
  });
});
```

**Test Failure Output:**
```
âŒ Expected: [expected value]
âŒ Received: [actual value]
âŒ Reason: [description of bug]
```

### ğŸŸ¢ GREEN PHASE
**Minimal Fix Implementation:**
```typescript
// Fixed implementation
[minimal code to make test pass]
```

**Test Success Output:**
```
âœ… Bug Fix: [Issue Name]
âœ… All tests passing
```

### ğŸ”µ REFACTOR PHASE
**Code Improvements:**
- [Improvement 1]
- [Improvement 2]

**Final Verification:**
âœ… All tests still passing
âœ… No regressions introduced
```

#### Level 2+ Modified Template
```markdown
## ğŸ§ª TDD IMPLEMENTATION: [Component/Feature Name]

### ğŸ”´ RED PHASE
**Test Suite:**
```typescript
describe('[Component/Feature]', () => {
  describe('Unit Tests', () => {
    it('should [behavior 1]', () => {
      // Test implementation
    });
    
    it('should [behavior 2]', () => {
      // Test implementation  
    });
  });
  
  describe('Integration Tests', () => {
    it('should [integration behavior]', () => {
      // Integration test
    });
  });
  
  describe('Acceptance Tests', () => {
    it('should [user story behavior]', () => {
      // Acceptance test
    });
  });
});
```

**Test Failure Documentation:**
```
âŒ Unit Tests: [X failed / Y total]
âŒ Integration Tests: [X failed / Y total]  
âŒ Acceptance Tests: [X failed / Y total]
âŒ Coverage: [X%] (Target: [Y%])
```

### ğŸŸ¢ GREEN PHASE
**Implementation Progress:**
- [ ] Unit test implementation
- [ ] Integration implementation
- [ ] Acceptance criteria implementation

**Test Success Documentation:**
```
âœ… Unit Tests: [All passing]
âœ… Integration Tests: [All passing]
âœ… Acceptance Tests: [All passing]
âœ… Coverage: [X%] (Target achieved)
```

### ğŸ”µ REFACTOR PHASE
**Refactoring Activities:**
- [ ] Code optimization
- [ ] Architecture improvements
- [ ] Documentation updates

**Final Verification:**
âœ… All tests still passing after refactoring
âœ… Code quality improved
âœ… Documentation updated
```

## ğŸ”’ ENFORCEMENT MECHANISMS

### Automatic Blocking Messages

```typescript
// Pseudocode for TDD enforcement
function attemptImplementation(code: string, hasFailingTest: boolean) {
  if (!hasFailingTest) {
    throw new TDDViolationError(`
ğŸš¨ TDD VIOLATION DETECTED ğŸš¨

IMPLEMENTATION BLOCKED: No failing test found.

MANDATORY ACTIONS:
1. Write failing test first
2. Show test failure output  
3. Then implement minimal solution

TDD is MANDATORY for ALL implementation tasks.
This is not optional.
    `);
  }
  
  return proceedWithImplementation(code);
}
```

### Checkpoint Verification

```markdown
## TDD CHECKPOINT VERIFICATION

### Before ANY code implementation:
- [ ] ğŸ”´ Failing test written and documented
- [ ] ğŸ”´ Test failure output shown
- [ ] ğŸ”´ Expected behavior documented

### During implementation:
- [ ] ğŸŸ¢ Writing minimal code only
- [ ] ğŸŸ¢ Focusing on making tests pass
- [ ] ğŸŸ¢ Running tests frequently

### After implementation:
- [ ] ğŸŸ¢ All tests passing
- [ ] ğŸ”µ Refactoring opportunities identified
- [ ] ğŸ”µ Code quality improved
- [ ] ğŸ”µ Documentation updated

â›” STOP: If any checkbox is unchecked
âœ… PROCEED: Only when all checkboxes are checked
```

## ğŸ”„ INTEGRATION WITH MEMORY BANK

### Updated Memory Bank Documentation

```markdown
## TDD Integration in Memory Bank Files

### tasks.md Updates
- Track TDD cycle completion for each task/subtask
- Document test coverage metrics
- Link to test files and test results

### progress.md Updates  
- Record TDD cycle progress
- Note test-driven milestones
- Track refactoring improvements

### activeContext.md Updates
- Current TDD phase (RED/GREEN/REFACTOR)
- Active test scenarios
- Test coverage status
```

## ğŸš¨ ZERO TOLERANCE POLICY

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ â›” ABSOLUTE PROHIBITION â›”                           â”‚
â”‚                                                     â”‚
â”‚ NO implementation code may be written without       â”‚
â”‚ following the complete TDD cycle:                   â”‚
â”‚                                                     â”‚
â”‚ 1. ğŸ”´ Failing test FIRST                           â”‚
â”‚ 2. ğŸŸ¢ Minimal implementation                       â”‚
â”‚ 3. ğŸ”µ Refactor (if needed)                        â”‚
â”‚                                                     â”‚
â”‚ This applies to ALL levels, ALL features,          â”‚
â”‚ ALL bug fixes, ALL enhancements.                   â”‚
â”‚                                                     â”‚
â”‚ VIOLATIONS WILL RESULT IN IMPLEMENTATION BLOCKING   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ“ˆ TDD BENEFITS TRACKING

Track and measure TDD adoption benefits:

- **Code Quality:** Reduction in bugs post-implementation
- **Test Coverage:** Percentage of code covered by tests
- **Refactoring Safety:** Ability to safely improve code
- **Documentation:** Tests serve as living documentation
- **Confidence:** Increased confidence in code changes
- **Maintainability:** Easier to maintain and extend code

This TDD enforcement ensures that all implementation across ALL complexity levels follows test-driven practices, resulting in higher quality, more maintainable, and better-documented code.
