import{j as a,bp as D,B as k,b as T,a5 as E,J as g,c as I,bm as w,ar as F,I as W,aa as B,aZ as R,bq as $,C as z}from"./mui-vendor-tGclxw8b.js";import{a as A}from"./react-vendor-DYr15v6v.js";import{u as M,a8 as N,e as V}from"./index-Cb91SdTK.js";const q={position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)",width:"95%",maxWidth:{xs:"100%",sm:550,md:600},maxHeight:{xs:"90vh",sm:"85vh"},overflow:"auto",bgcolor:"background.paper",boxShadow:24,p:{xs:2,sm:3,md:4},borderRadius:1},Z=({product:s,onClose:l,onSave:d})=>{const[o,p]=A.useState({name:s.name,description:s.description}),h=m=>r=>{p(c=>({...c,[m]:r.target.value}))},x=m=>{m.preventDefault(),d(s.sku,o)};return a.jsx(D,{open:!0,onClose:l,children:a.jsxs(k,{sx:q,children:[a.jsx(T,{variant:"h6",component:"h2",gutterBottom:!0,children:"Edit Product"}),a.jsx("form",{onSubmit:x,children:a.jsxs(E,{spacing:3,children:[a.jsx(g,{label:"SKU",value:s.sku,disabled:!0,fullWidth:!0,inputProps:{"aria-label":"SKU"}}),a.jsx(g,{label:"Platform",value:s.platform,disabled:!0,fullWidth:!0,inputProps:{"aria-label":"Platform"}}),a.jsx(g,{label:"Name",value:o.name,onChange:h("name"),fullWidth:!0,required:!0,inputProps:{"aria-label":"Name"}}),a.jsx(g,{label:"Description",value:o.description,onChange:h("description"),fullWidth:!0,multiline:!0,rows:3,required:!0,inputProps:{"aria-label":"Description"}}),a.jsxs(k,{display:"flex",gap:2,justifyContent:"flex-end",children:[a.jsx(I,{onClick:l,color:"inherit",children:"Cancel"}),a.jsx(I,{type:"submit",variant:"contained",color:"primary",children:"Save Changes"})]})]})})]})})},i=s=>{if(s==null)return"";const l=String(s);return l.includes(",")||l.includes('"')||l.includes(`
`)?`"${l.replace(/"/g,'""')}"`:l},P=s=>{if(!s)return"";try{return s.toDate().toLocaleString("en-US",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit",second:"2-digit",hour12:!1})}catch(l){return console.warn("Error formatting timestamp:",l),""}},G=(s,l=[])=>{const d=new Map(l.map(e=>[e.id,e.name])),o=["SKU","Name","Description","Platform","Visibility","Cost Price","Selling Price","Category","Inventory Quantity","Low Stock Threshold","Inventory Last Updated","Listing Status","MOQ","Amazon Serial Number","Flipkart Serial Number","Created At","Updated At","Last Imported From","Exists On Seller Page","Competition Analysis"],p=s.map(e=>{var u,f,y,b,C,v,S,j,n,t;return[i(e.sku),i(e.name),i(e.description),i(e.platform),i(e.visibility),i(e.customCostPrice),i(e.sellingPrice),i(e.categoryId?d.get(e.categoryId)||"Unknown Category":"Uncategorized"),i((u=e.inventory)==null?void 0:u.quantity),i((f=e.inventory)==null?void 0:f.lowStockThreshold),i((y=e.inventory)!=null&&y.lastUpdated?P(e.inventory.lastUpdated):""),i((b=e.metadata)==null?void 0:b.listingStatus),i((C=e.metadata)==null?void 0:C.moq),i((v=e.metadata)==null?void 0:v.amazonSerialNumber),i((S=e.metadata)==null?void 0:S.flipkartSerialNumber),i((j=e.metadata)!=null&&j.createdAt?P(e.metadata.createdAt):""),i((n=e.metadata)!=null&&n.updatedAt?P(e.metadata.updatedAt):""),i((t=e.metadata)==null?void 0:t.lastImportedFrom),i(e.existsOnSellerPage!==void 0?e.existsOnSellerPage?"Yes":"No":""),i(e.competitionAnalysis?`Competitor: ${e.competitionAnalysis.competitorName}, Price: ${e.competitionAnalysis.competitorPrice}, Total Sellers: ${e.competitionAnalysis.totalSellers}`:"")]}),h=[o.join(","),...p.map(e=>e.join(","))].join(`
`),x=new Blob([h],{type:"text/csv;charset=utf-8;"}),m=window.URL.createObjectURL(x),r=document.createElement("a"),c=new Date().toISOString().split("T")[0];r.href=m,r.download=`products-export-${c}.csv`,document.body.appendChild(r),r.click(),document.body.removeChild(r),window.URL.revokeObjectURL(m)},K=$(),X=({platform:s,search:l,selectedProducts:d,categories:o,allProducts:p,onFilterChange:h,onBulkCategoryUpdate:x})=>{const m=M(),[r,c]=A.useState(null),[e,u]=A.useState(""),[f,y]=A.useState(!1),b=n=>{const t=n.target.value;h({platform:t===""?void 0:t,search:l})},C=n=>{const t=n.target.value;h({platform:s,search:t})},v=()=>{G(p,o)},S=async()=>{if(e){y(!0);try{const n=await m(N({name:e,costPrice:null}));if(N.fulfilled.match(n)&&typeof n.payload=="string"){const t=n.payload;d.length>0&&await x(d,t),m(V()),u(""),c(null)}}catch{}finally{y(!1)}}},j=async()=>{if(d.length>0&&r)try{await x(d,r),c(null)}catch{}};return a.jsxs(k,{sx:{mb:2,display:"flex",flexDirection:{xs:"column",sm:"row"},gap:2,alignItems:"center"},children:[a.jsxs(g,{select:!0,label:"Platform",value:s??"",onChange:b,sx:{minWidth:{xs:"100%",sm:200},flexGrow:{xs:1,sm:0}},children:[a.jsx(w,{value:"",children:"All"}),a.jsx(w,{value:"amazon",children:"Amazon"}),a.jsx(w,{value:"flipkart",children:"Flipkart"})]}),a.jsx(g,{label:"Search",value:l,onChange:C,sx:{minWidth:{xs:"100%",sm:200},flexGrow:1}}),a.jsx(F,{title:"Export all products to CSV",children:a.jsx(W,{onClick:v,color:"primary",disabled:p.length===0,sx:{border:"1px solid",borderColor:"primary.main","&:hover":{backgroundColor:"primary.light",color:"white"}},children:a.jsx(B,{})})}),d.length>0&&a.jsxs(a.Fragment,{children:[a.jsx(R,{options:o,getOptionLabel:n=>typeof n=="string"?n:n.name,value:o.find(n=>n.id===r)||null,onChange:(n,t)=>{t&&typeof t=="object"&&"inputValue"in t?(u(t.inputValue),c(null)):t&&typeof t=="object"?(c(t.id||null),u("")):t===null?(c(null),u("")):typeof t=="string"&&(u(t),c(null))},filterOptions:(n,t)=>{const O=[...K(o,t)],U=o.map(L=>L.name.toLowerCase());return t.inputValue!==""&&!U.includes(t.inputValue.toLowerCase())&&O.push({id:`add-${t.inputValue}`,name:`Add "${t.inputValue}"`,inputValue:t.inputValue}),O},selectOnFocus:!0,clearOnBlur:!0,handleHomeEndKeys:!0,freeSolo:!0,renderOption:(n,t)=>a.jsx("li",{...n,children:typeof t=="string"?t:t.name}),renderInput:n=>a.jsx(g,{...n,label:"Assign Category",variant:"outlined",sx:{minWidth:{xs:"100%",sm:200},flexGrow:{xs:1,sm:.5}}})}),a.jsxs(I,{variant:"contained",onClick:()=>{e?S():r&&j()},disabled:!r&&!e||f,startIcon:f?a.jsx(z,{size:20,color:"inherit"}):null,sx:{minWidth:{xs:"100%",sm:150},flexGrow:{xs:1,sm:0}},children:[f?"Adding...":e?"Add & Assign":"Assign"," (",d.length,")"]})]})]})};export{X as P,Z as a};
