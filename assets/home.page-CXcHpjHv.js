import{j as e,X as ee,B as c,a9 as te,b as u,c as I,aa as se,ab as oe,ac as ae,ad as E,ae as re,C as ne,U,af as be,a5 as De,a6 as A,ag as Ce,ah as ve,D as M,J,ai as we,K as le,aj as ie,G as T,I as K,ak as Se,al as W,am as Pe,an as Fe,ao as Ie,ap as ke,aq as ze,ar as Ae,as as $e,at as ce,k as Te,au as We,a2 as Ee,a1 as N,i as Le,l as Be,g as Ue,u as Oe,h as Me,z as Re,av as _e,aw as Ne,p as Ye,ax as Ge}from"./mui-vendor-tGclxw8b.js";import{a as j}from"./react-vendor-DYr15v6v.js";import{u as He,a as Y,s as Je,f as Ke,e as qe,g as G,h as Qe,i as Ve,r as Xe,j as Ze,k as et,l as tt,m as st}from"./index-Cb91SdTK.js";import{d as de,p as H}from"./pdfStorageService-CLDArnMX.js";import"./redux-vendor-CLOwJCHO.js";import"./firebase-vendor-yCdHbQaA.js";import"./utils-vendor-CFocuF-S.js";import"./pdf-vendor-BVWGQTu2.js";function ot(s,o){const a=document.createElement("a");document.body.appendChild(a),a.style.display="none",a.href=o,a.target="_blank",a.download="pdf-merged-"+Date.now(),a.click(),document.body.removeChild(a),s.preventDefault()}const at=({pdfUrl:s})=>e.jsx(ee,{sx:{p:{xs:2,sm:3},mb:{xs:3,sm:4},display:"flex",flexDirection:{xs:"column",sm:"row"},alignItems:"center",justifyContent:"center",gap:{xs:2,sm:3}},children:s&&e.jsxs(c,{sx:{textAlign:"center",width:"100%"},children:[e.jsx(te,{sx:{fontSize:{xs:28,sm:32},color:"primary.main",mb:1}}),e.jsx(u,{variant:"subtitle2",color:"text.secondary",gutterBottom:!0,children:"Download Merged Labels"}),e.jsx(I,{variant:"contained",color:"primary",href:s,startIcon:e.jsx(se,{}),onClick:o=>ot(o,s),sx:{minWidth:{xs:"100%",sm:200},width:{xs:"100%",sm:"auto"}},children:"Download PDF"})]})}),rt=({url:s,pdfUrl:o})=>{const a=s||o||"";return e.jsx(c,{sx:{width:"100%",height:"100%",overflow:"hidden"},children:e.jsx("iframe",{src:a,width:"100%",height:"100%",style:{border:"none",display:"block"},title:"PDF Preview"})})},nt=({open:s,onClose:o,onConfirm:a,fileName:C,products:b,categories:l,isUploading:d})=>{const[P,F]=j.useState(de),[m,v]=j.useState(""),w=b.filter(n=>n.categoryId&&n.categoryId.trim()!==""),k=new Set(w.map(n=>n.categoryId)),y={totalProducts:b.length,totalCategories:l.length,categorizedProducts:w.length,categoriesWithProducts:k.size},x=n=>{const t=parseInt(n.target.value);F(r=>({...r,expiryDays:isNaN(t)||t<1?1:t>90?90:t}))},f=n=>{v(n.target.value)},p=()=>{a({...P,description:m.trim()||`Sorted PDF with ${y.totalProducts} products across ${y.categoriesWithProducts} categories`})};return e.jsxs(oe,{open:s,onClose:d?void 0:o,maxWidth:"sm",fullWidth:!0,PaperProps:{sx:{borderRadius:2,boxShadow:10}},children:[e.jsxs(ae,{sx:{display:"flex",alignItems:"center",bgcolor:"primary.main",color:"white"},children:[e.jsx(E,{sx:{mr:1}}),"Save to Cloud Storage"]}),e.jsx(re,{sx:{pt:3},children:d?e.jsxs(c,{sx:{display:"flex",flexDirection:"column",alignItems:"center",py:4},children:[e.jsx(ne,{size:60}),e.jsx(u,{variant:"h6",sx:{mt:2},children:"Uploading PDF to Storage..."}),e.jsx(u,{variant:"body2",color:"text.secondary",sx:{mt:1},children:"Please wait while your file is being uploaded"})]}):e.jsxs(e.Fragment,{children:[e.jsx(U,{severity:"info",sx:{mb:3},children:"Your PDF will be stored in the cloud and automatically sorted by category."}),e.jsxs(c,{sx:{mb:3},children:[e.jsx(u,{variant:"subtitle1",fontWeight:"bold",gutterBottom:!0,children:"File Information"}),e.jsxs(c,{sx:{display:"flex",alignItems:"center",mb:1},children:[e.jsx(be,{fontSize:"small",sx:{mr:1,color:"text.secondary"}}),e.jsx(u,{variant:"body2",children:C})]}),e.jsxs(De,{direction:"row",spacing:1,sx:{mb:2},children:[e.jsx(A,{icon:e.jsx(Ce,{}),label:`${y.categoriesWithProducts} Categories`,color:"primary",size:"small"}),e.jsx(A,{icon:e.jsx(ve,{}),label:`${y.totalProducts} Products`,color:"secondary",size:"small"})]}),e.jsx(U,{severity:"success",sx:{mb:2},children:"Products will be automatically sorted by category, then by SKU"})]}),e.jsx(M,{sx:{my:2}}),e.jsx(J,{label:"Description (optional)",fullWidth:!0,multiline:!0,rows:2,value:m,onChange:f,placeholder:`Sorted PDF with ${y.totalProducts} products across ${y.categoriesWithProducts} categories`,sx:{mb:3}}),e.jsxs(c,{sx:{display:"flex",alignItems:"center",mb:3},children:[e.jsx(we,{fontSize:"small",sx:{mr:1,color:"text.secondary"}}),e.jsx(J,{label:"Expiry (Days)",type:"number",value:P.expiryDays,onChange:x,InputProps:{inputProps:{min:1,max:90},endAdornment:e.jsx(le,{position:"end",children:"days"})},sx:{width:"150px"},helperText:"1-90 days"})]})]})}),e.jsxs(ie,{sx:{px:3,py:2},children:[e.jsx(I,{onClick:o,disabled:d,children:"Cancel"}),e.jsx(I,{onClick:p,variant:"contained",startIcon:e.jsx(E,{}),disabled:d,children:"Save to Cloud"})]})]})},lt=({uploadResult:s,onClose:o,onDelete:a})=>{const[C,b]=j.useState(!1),[l,d]=j.useState(!1),P=()=>{navigator.clipboard.writeText(s.downloadUrl).then(()=>{b(!0),setTimeout(()=>b(!1),2e3)},x=>console.error("Could not copy text: ",x))},F=()=>{a(s.fileId),d(!1)},m=x=>new Date(x).toLocaleDateString("en-US",{weekday:"short",year:"numeric",month:"short",day:"numeric"}),v=x=>{const f=new Date().getTime(),p=new Date(x).getTime();return Math.ceil((p-f)/(1e3*60*60*24))},w=()=>{var p;const x=(p=s.metadata)==null?void 0:p.storagePath;if(!x)return"Cloud Storage";const f=x.split("/");if(f.length>=3){const n=f[2],t=/^(\d{2})-(\d{2})-(\d{4})$/,r=n.match(t);if(r){const[,g,h,D]=r;return`${["January","February","March","April","May","June","July","August","September","October","November","December"][parseInt(h,10)-1]||h} ${g}, ${D}`}return n}return"Cloud Storage"},k=v(s.expiresAt),y=w();return e.jsxs(e.Fragment,{children:[e.jsxs(T,{sx:{mb:4,position:"relative",borderRadius:2,border:"1px solid",borderColor:"success.main"},children:[e.jsx(c,{sx:{position:"absolute",top:10,right:10},children:e.jsx(K,{size:"small",onClick:o,children:e.jsx(Se,{fontSize:"small"})})}),e.jsxs(W,{sx:{pt:3,pb:3},children:[e.jsxs(c,{sx:{display:"flex",alignItems:"center",mb:2},children:[e.jsx(Pe,{color:"success",sx:{mr:1}}),e.jsx(u,{variant:"h6",color:"success.main",children:"PDF Successfully Uploaded"})]}),e.jsx(U,{severity:"success",sx:{mb:2},children:"Your PDF has been uploaded to cloud storage and is available for download."}),e.jsxs(c,{sx:{display:"flex",alignItems:"center",mb:2},children:[e.jsx(Fe,{fontSize:"small",color:"primary",sx:{mr:1}}),e.jsxs(u,{variant:"body2",children:["Stored in: ",e.jsx("strong",{children:y})]})]}),e.jsxs(c,{sx:{display:"flex",alignItems:"center",flexWrap:"wrap",gap:1,mb:3},children:[e.jsx(A,{icon:e.jsx(Ie,{fontSize:"small"}),label:`Expires: ${m(s.expiresAt)}`,size:"small",color:"primary",variant:"outlined"}),e.jsx(A,{icon:e.jsx(ke,{fontSize:"small"}),label:`${k} days remaining`,size:"small",color:k<=7?"warning":"default",variant:"outlined"}),s.isShared&&e.jsx(A,{icon:e.jsx(ze,{fontSize:"small"}),label:"Shared",size:"small",color:"secondary",variant:"outlined"})]}),e.jsx(M,{sx:{my:2}}),e.jsxs(c,{sx:{mb:3},children:[e.jsx(u,{variant:"subtitle2",gutterBottom:!0,children:"Download Link"}),e.jsx(J,{fullWidth:!0,variant:"outlined",value:s.downloadUrl,InputProps:{readOnly:!0,endAdornment:e.jsx(le,{position:"end",children:e.jsx(Ae,{title:C?"Copied!":"Copy link",children:e.jsx(K,{edge:"end",onClick:P,size:"small",children:e.jsx($e,{fontSize:"small"})})})})},size:"small"})]}),e.jsxs(c,{sx:{display:"flex",justifyContent:"space-between",flexWrap:"wrap",gap:2},children:[e.jsx(I,{variant:"outlined",color:"error",startIcon:e.jsx(ce,{}),onClick:()=>d(!0),size:"small",children:"Delete From Cloud"}),e.jsx(I,{variant:"contained",color:"primary",component:Te,href:s.downloadUrl,target:"_blank",startIcon:e.jsx(se,{}),size:"small",children:"Download Now"})]})]})]}),e.jsxs(oe,{open:l,onClose:()=>d(!1),children:[e.jsx(ae,{children:"Delete PDF from Cloud Storage?"}),e.jsx(re,{children:e.jsx(We,{children:"This will permanently remove the PDF from cloud storage. This action cannot be undone."})}),e.jsxs(ie,{children:[e.jsx(I,{onClick:()=>d(!1),children:"Cancel"}),e.jsx(I,{onClick:F,color:"error",autoFocus:!0,children:"Delete"})]})]})]})},Z=s=>{const o=j.useId(),a=()=>s.selected?s.fileCount&&s.fileCount>1?`${s.fileCount} Files Selected`:"File Selected":`Select ${s.name}`;return e.jsxs(e.Fragment,{children:[e.jsx("input",{id:o,accept:s.accepts,style:{display:"none"},type:"file",onChange:s.onChange,multiple:s.multiple}),e.jsx("label",{htmlFor:o,children:e.jsx(I,{component:"span",color:s.selected?"success":"primary",variant:s.selected?"contained":"outlined",tabIndex:-1,startIcon:s.selected?e.jsx(Ee,{}):e.jsx(E,{}),sx:{transition:"all 0.2s ease-in-out",minWidth:180,"&:hover":{transform:"translateY(-2px)"}},children:a()})})]})},it=({amazonFiles:s,flipkartFiles:o,onAmazonAdd:a,onFlipkartAdd:C,onAmazonRemove:b,onFlipkartRemove:l,onAmazonClear:d,onFlipkartClear:P})=>{const[F,m]=j.useState(!1),[v,w]=j.useState(!1),k=t=>{const r=t.target.files;if(r)for(let g=0;g<r.length;g++)a(r[g])},y=t=>{const r=t.target.files;if(r)for(let g=0;g<r.length;g++)C(r[g])},x=(t,r)=>{t.preventDefault(),t.stopPropagation(),r(!0)},f=(t,r)=>{t.preventDefault(),t.stopPropagation(),r(!1)},p=(t,r,g)=>{if(t.preventDefault(),t.stopPropagation(),g(!1),t.dataTransfer.files&&t.dataTransfer.files.length>0){const h=t.dataTransfer.files;for(let D=0;D<h.length;D++)h[D].type==="application/pdf"&&r(h[D])}},n=(t,r,g)=>t.length===0?null:e.jsxs(c,{sx:{mt:2,width:"100%"},children:[e.jsxs(c,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:1},children:[e.jsxs(u,{variant:"subtitle2",color:"text.secondary",children:[t.length," ",t.length===1?"file":"files"," selected"]}),t.length>1&&e.jsx(A,{label:"Clear All",size:"small",color:"error",variant:"outlined",onClick:g})]}),e.jsx(Le,{dense:!0,sx:{maxHeight:"150px",overflow:"auto",bgcolor:"background.paper",borderRadius:1},children:t.map((h,D)=>e.jsx(Be,{secondaryAction:e.jsx(K,{edge:"end","aria-label":"delete",size:"small",onClick:()=>r(D),children:e.jsx(ce,{fontSize:"small"})}),children:e.jsx(Ue,{primary:h.name,secondary:`${(h.size/1024).toFixed(1)} KB`,primaryTypographyProps:{noWrap:!0}})},`${h.name}-${D}`))})]});return e.jsxs(N,{container:!0,spacing:3,children:[e.jsx(N,{item:!0,xs:12,md:6,children:e.jsx(T,{variant:"outlined",sx:{height:"100%",transition:"all 0.3s ease-in-out","&:hover":{transform:"translateY(-4px)",boxShadow:t=>t.palette.mode==="dark"?"0 4px 8px rgba(0,0,0,0.3)":"0 4px 8px rgba(33,150,243,0.15)"},...F&&{border:"2px dashed",borderColor:"primary.main",backgroundColor:"rgba(33, 150, 243, 0.04)"}},onDragOver:t=>x(t,m),onDragLeave:t=>f(t,m),onDrop:t=>p(t,a,m),children:e.jsx(W,{children:e.jsxs(c,{sx:{display:"flex",flexDirection:"column",alignItems:"center",p:3,textAlign:"center"},children:[e.jsx(E,{sx:{fontSize:48,mb:2,color:t=>s.length>0?t.palette.success.main:t.palette.primary.main}}),e.jsx(u,{variant:"h6",gutterBottom:!0,children:"Amazon Labels"}),e.jsx(u,{variant:"body2",color:"text.secondary",sx:{mb:2},children:s.length>0?`${s.length} Amazon file${s.length!==1?"s":""} selected`:F?"Drop PDF files here":"Upload or drop Amazon shipping labels (PDF)"}),e.jsx(Z,{accepts:"application/pdf",name:"amazon",onChange:k,selected:s.length>0,fileCount:s.length,multiple:!0}),n(s,b,d)]})})})}),e.jsx(N,{item:!0,xs:12,md:6,children:e.jsx(T,{variant:"outlined",sx:{height:"100%",transition:"all 0.3s ease-in-out","&:hover":{transform:"translateY(-4px)",boxShadow:t=>t.palette.mode==="dark"?"0 4px 8px rgba(0,0,0,0.3)":"0 4px 8px rgba(33,150,243,0.15)"},...v&&{border:"2px dashed",borderColor:"primary.main",backgroundColor:"rgba(33, 150, 243, 0.04)"}},onDragOver:t=>x(t,w),onDragLeave:t=>f(t,w),onDrop:t=>p(t,C,w),children:e.jsx(W,{children:e.jsxs(c,{sx:{display:"flex",flexDirection:"column",alignItems:"center",p:3,textAlign:"center"},children:[e.jsx(E,{sx:{fontSize:48,mb:2,color:t=>o.length>0?t.palette.success.main:t.palette.primary.main}}),e.jsx(u,{variant:"h6",gutterBottom:!0,children:"Flipkart Labels"}),e.jsx(u,{variant:"body2",color:"text.secondary",sx:{mb:2},children:o.length>0?`${o.length} Flipkart file${o.length!==1?"s":""} selected`:v?"Drop PDF files here":"Upload or drop Flipkart shipping labels (PDF)"}),e.jsx(Z,{accepts:"application/pdf",name:"flipkart",selected:o.length>0,fileCount:o.length,multiple:!0,onChange:y}),n(o,l,P)]})})})})]})},ft=()=>{const s=Oe(),o=Me(s.breakpoints.down("sm")),a=He(),{amazonFiles:C,flipkartFiles:b,finalPdf:l,summary:d,loading:P,error:F}=Y(i=>i.pdfMerger),{categories:m,items:v}=Y(i=>i.products),w=Y(Je),[k,y]=j.useState(!1),[x,f]=j.useState(!1),[p,n]=j.useState(null),[t,r]=j.useState(!1),[g,h]=j.useState(void 0),[D,O]=j.useState(null);j.useEffect(()=>{(async()=>{v.length===0&&await a(Ke({})).unwrap(),m.length===0&&await a(qe()).unwrap()})().catch(console.error)},[a,v.length,m.length]),j.useEffect(()=>{if(!l||x||p||!w||l===D)return;console.log("Auto-saving new PDF:",l),O(l);const i=async()=>{var S;try{if(!l)return;const V=await(await fetch(l)).blob(),L=`sorted_labels_${new Date().toISOString().replace(/[:.-]/g,"_")}.pdf`,R={...de,expiryDays:7,description:`Auto-saved PDF with ${d.length} products across ${m.filter(_=>!!_.name).length} categories`},B=await H.uploadPdf(V,L,{categoryCount:m.length,productCount:d.length,sortConfig:G,description:`Auto-saved PDF with ${d.length} products across ${m.filter(_=>!!_.name).length} categories`},R);B.success?(n(B),r(!0)):(console.error("Error auto-uploading PDF:",B.error),h(B.error||"Failed to auto-save PDF"),(S=B.error)!=null&&S.includes("authenticated")&&(console.log("Authentication error during auto-save, skipping..."),h(void 0)))}catch(z){console.error("Error auto-uploading PDF:",z),h(z instanceof Error?z.message:"Failed to auto-save PDF"),z instanceof Error&&z.message.includes("authenticated")&&(console.log("Authentication error during auto-save, skipping..."),h(void 0))}};f(!0),i().finally(()=>{f(!1)})},[l,x,p,d.length,m,w,D]);const q=async()=>{if(!(C.length===0&&b.length===0)){n(null),r(!1),O(null);try{await a(st({amazonFiles:C,flipkartFiles:b,sortConfig:G})).unwrap()}catch(i){console.error(i)}}},xe=i=>{a(tt(i)),$()},he=i=>{a(et(i)),$()},me=i=>{a(Ze(i)),$()},ue=i=>{a(Xe(i)),$()},pe=()=>{a(Ve()),$()},ge=()=>{a(Qe()),$()},$=()=>{r(!1),n(null),O(null)},fe=()=>{l&&y(!0)},je=async i=>{if(l){f(!0);try{const z=await(await fetch(l)).blob(),X=`sorted_labels_${new Date().toISOString().replace(/[:.-]/g,"_")}.pdf`,L=await H.uploadPdf(z,X,{categoryCount:m.length,productCount:d.length,sortConfig:G,description:`Sorted PDF with ${d.length} products across ${m.filter(R=>!!R.name).length} categories`},i);L.success?(n(L),r(!0),y(!1)):h(L.error||"Failed to save PDF to cloud")}catch(S){console.error("Error uploading PDF:",S),h(S instanceof Error?S.message:"Failed to save PDF to cloud")}finally{f(!1)}}},ye=async i=>{try{await H.deletePdf(i),r(!1),n(null)}catch(S){console.error("Error deleting PDF:",S),h(S instanceof Error?S.message:"Failed to delete PDF")}},Q=()=>{h(void 0)};return e.jsx(Re,{maxWidth:"xl",sx:{py:o?2:3},children:e.jsxs(ee,{sx:{p:o?2:3,mb:4,borderRadius:2,boxShadow:s.shadows[3]},elevation:3,children:[e.jsxs(c,{sx:{display:"flex",alignItems:"center",mb:3,flexDirection:o?"column":"row",gap:o?1:0},children:[e.jsxs(c,{sx:{display:"flex",alignItems:"center",justifyContent:o?"center":"flex-start",width:o?"100%":"auto"},children:[e.jsx(_e,{sx:{fontSize:o?28:32,mr:2,color:"primary.main"}}),e.jsx(u,{variant:o?"h5":"h4",component:"h1",sx:{fontWeight:"bold",color:"primary.dark"},children:"PDF Merger"})]}),o&&e.jsx(M,{flexItem:!0,sx:{my:1}})]}),e.jsx(M,{sx:{mb:3}}),e.jsx(T,{sx:{mb:3,borderRadius:2,border:"1px solid",borderColor:"primary.light",overflow:"visible",boxShadow:s.shadows[2]},children:e.jsxs(W,{sx:{p:{xs:2,sm:3}},children:[e.jsxs(u,{variant:o?"h6":"h5",gutterBottom:!0,children:[e.jsx(te,{sx:{mr:1,verticalAlign:"middle"}}),"Upload PDF Files"]}),e.jsx(u,{variant:"body2",color:"text.secondary",paragraph:!0,children:"Upload PDF files from Amazon and/or Flipkart. The tool will merge them into a unified PDF document sorted by product categories."}),e.jsx(it,{amazonFiles:C,flipkartFiles:b,onAmazonAdd:xe,onFlipkartAdd:he,onAmazonRemove:me,onFlipkartRemove:ue,onAmazonClear:pe,onFlipkartClear:ge}),e.jsxs(c,{sx:{mt:3,textAlign:"center"},children:[e.jsx(I,{variant:"contained",color:"primary",size:"large",disabled:C.length===0&&b.length===0||P,onClick:q,startIcon:P?e.jsx(ne,{size:20}):e.jsx(Ne,{}),sx:{minWidth:200,py:1,borderRadius:2,textTransform:"none",fontWeight:600},children:P?"Processing...":"Generate PDF"}),e.jsx(Ye,{in:!!F,children:e.jsx(U,{severity:"error",sx:{mt:2,mx:"auto",maxWidth:600},children:F})})]})]})}),l&&e.jsx(T,{sx:{mb:3,borderRadius:2,border:"1px solid",borderColor:"success.light",backgroundColor:"success.lightest",boxShadow:s.shadows[2]},children:e.jsxs(W,{sx:{p:{xs:2,sm:3}},children:[e.jsxs(c,{sx:{mb:2,display:"flex",alignItems:"center"},children:[e.jsx(u,{variant:"h6",component:"h3",color:"success.main",sx:{fontWeight:600},children:"PDF Generated Successfully!"}),e.jsx(A,{label:`${d.length} Products`,color:"success",size:"small",sx:{ml:2}}),e.jsx(I,{variant:"contained",color:"secondary",size:"small",onClick:fe,disabled:x||t,startIcon:e.jsx(E,{}),sx:{ml:"auto",borderRadius:4},children:x?"Saving...":"Save to Cloud"})]}),e.jsx(at,{pdfUrl:l}),t&&p&&p.fileId&&e.jsx(lt,{uploadResult:p,onDelete:()=>ye(p.fileId),onClose:()=>r(!1)})]})}),l&&e.jsx(T,{sx:{borderRadius:2,border:"1px solid",borderColor:"primary.light",overflow:"hidden",boxShadow:s.shadows[2]},children:e.jsx(W,{sx:{p:0},children:e.jsx(rt,{pdfUrl:l})})}),e.jsx(nt,{open:k,onClose:()=>y(!1),onConfirm:je,fileName:`sorted_labels_${new Date().toISOString().slice(0,10)}.pdf`,products:v,categories:m,isUploading:x}),e.jsx(Ge,{open:!!g,autoHideDuration:6e3,onClose:Q,anchorOrigin:{vertical:"bottom",horizontal:"center"},children:e.jsx(U,{onClose:Q,severity:"error",sx:{width:"100%"},children:g})})]})})};export{ft as HomePage};
