import{j as e,B as d,C as Z,b as c,be as ee,bc as te,bl as re,bm as p,c as X,aQ as se,by as ne,a1 as D,G as I,al as E,F as ae,U as k,a3 as ie,x as ce,a7 as oe,X as N,aH as le,aI as de,aJ as ue,aK as _,aL as v,aN as he,a6 as Y,ar as me,I as xe,P as fe,bz as ge}from"./mui-vendor-tGclxw8b.js";import{a as S}from"./react-vendor-DYr15v6v.js";import{M as w,N as je,R as F,T as ye,$ as De,_ as U,ah as G,ai as L,aj as B}from"./index-Cb91SdTK.js";import{e as ve,a as Se}from"./endOfMonth-D_6NHXpV.js";import"./redux-vendor-CLOwJCHO.js";import"./firebase-vendor-yCdHbQaA.js";import"./utils-vendor-CFocuF-S.js";import"./pdf-vendor-BVWGQTu2.js";function P(s,a){const t=+w(s)-+w(a);return t<0?-1:t>0?1:t}function Me(s){return je(s,Date.now())}function be(s,a,t){const[h,r]=F(t==null?void 0:t.in,s,a),x=h.getFullYear()-r.getFullYear(),o=h.getMonth()-r.getMonth();return x*12+o}function pe(s){return a=>{const h=(s?Math[s]:Math.trunc)(a);return h===0?0:h}}function we(s,a){return+w(s)-+w(a)}function Te(s,a){const t=w(s,a==null?void 0:a.in);return+ve(t,a)==+Se(t,a)}function Ce(s,a,t){const[h,r,x]=F(t==null?void 0:t.in,s,s,a),o=P(r,x),i=Math.abs(be(r,x));if(i<1)return 0;r.getMonth()===1&&r.getDate()>27&&r.setDate(30),r.setMonth(r.getMonth()-o*i);let y=P(r,x)===-o;Te(h)&&i===1&&P(h,x)===1&&(y=!1);const g=o*(i-+y);return g===0?0:g}function Ie(s,a,t){const h=we(s,a)/1e3;return pe(t==null?void 0:t.roundingMethod)(h)}function Ee(s,a,t){const h=ye(),r=(t==null?void 0:t.locale)??h.locale??De,x=2520,o=P(s,a);if(isNaN(o))throw new RangeError("Invalid time value");const i=Object.assign({},t,{addSuffix:t==null?void 0:t.addSuffix,comparison:o}),[y,g]=F(t==null?void 0:t.in,...o>0?[a,s]:[s,a]),f=Ie(g,y),R=(U(g)-U(y))/1e3,l=Math.round((f-R)/60);let j;if(l<2)return t!=null&&t.includeSeconds?f<5?r.formatDistance("lessThanXSeconds",5,i):f<10?r.formatDistance("lessThanXSeconds",10,i):f<20?r.formatDistance("lessThanXSeconds",20,i):f<40?r.formatDistance("halfAMinute",0,i):f<60?r.formatDistance("lessThanXMinutes",1,i):r.formatDistance("xMinutes",1,i):l===0?r.formatDistance("lessThanXMinutes",1,i):r.formatDistance("xMinutes",l,i);if(l<45)return r.formatDistance("xMinutes",l,i);if(l<90)return r.formatDistance("aboutXHours",1,i);if(l<G){const m=Math.round(l/60);return r.formatDistance("aboutXHours",m,i)}else{if(l<x)return r.formatDistance("xDays",1,i);if(l<L){const m=Math.round(l/G);return r.formatDistance("xDays",m,i)}else if(l<L*2)return j=Math.round(l/L),r.formatDistance("aboutXMonths",j,i)}if(j=Ce(g,y),j<12){const m=Math.round(l/L);return r.formatDistance("xMonths",m,i)}else{const m=j%12,M=Math.trunc(j/12);return m<3?r.formatDistance("aboutXYears",M,i):m<9?r.formatDistance("overXYears",M,i):r.formatDistance("almostXYears",M+1,i)}}function W(s,a){return Ee(s,Me(s),a)}const ke=()=>{const[s,a]=S.useState([]),[t,h]=S.useState([]),[r,x]=S.useState([]),[o,i]=S.useState({errorCount:0,avgPerformance:0,sessionCount:0,criticalErrors:0}),[y,g]=S.useState(!0),[f,R]=S.useState("24h"),[l,j]=S.useState(null);S.useEffect(()=>{m()},[f]);const m=()=>{g(!0);try{const n=B.getStoredErrors(),T=B.getStoredPerformanceMetrics(),q=B.getStoredAnalytics(),O=M(f),A=Date.now(),C=n.filter(u=>A-new Date(u.timestamp).getTime()<=O),b=T.filter(u=>A-new Date(u.timestamp).getTime()<=O),H=q.filter(u=>A-new Date(u.timestamp).getTime()<=O);a(C),h(b),x(H);const K=new Set([...C.map(u=>u.sessionId),...b.map(u=>u.sessionId),...H.map(u=>u.sessionId)]),Q=b.length>0?b.reduce((u,$)=>u+$.metrics.pageLoadTime,0)/b.length:0;i({errorCount:C.length,avgPerformance:Q,sessionCount:K.size,criticalErrors:C.filter(u=>u.severity==="critical").length})}catch(n){console.error("Failed to load monitoring data:",n)}finally{g(!1)}},M=n=>{switch(n){case"1h":return 60*60*1e3;case"6h":return 6*60*60*1e3;case"24h":return 24*60*60*1e3;case"7d":return 7*24*60*60*1e3;case"30d":return 30*24*60*60*1e3;default:return 24*60*60*1e3}},J=n=>{switch(n){case"critical":return"error";case"high":return"warning";case"medium":return"info";case"low":return"success";default:return"default"}},V=()=>{B.clearStoredData(),m()},z=n=>n<1e3?{rating:"Excellent",color:"success.main"}:n<2500?{rating:"Good",color:"info.main"}:n<4e3?{rating:"Fair",color:"warning.main"}:{rating:"Poor",color:"error.main"};return y?e.jsx(d,{sx:{display:"flex",justifyContent:"center",alignItems:"center",height:"400px"},children:e.jsx(Z,{})}):e.jsxs(d,{sx:{padding:3},children:[e.jsxs(d,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:3},children:[e.jsx(c,{variant:"h4",gutterBottom:!0,children:"Monitoring Dashboard"}),e.jsxs(d,{sx:{display:"flex",gap:2,alignItems:"center"},children:[e.jsxs(ee,{size:"small",sx:{minWidth:120},children:[e.jsx(te,{children:"Time Range"}),e.jsxs(re,{value:f,label:"Time Range",onChange:n=>R(n.target.value),children:[e.jsx(p,{value:"1h",children:"Last Hour"}),e.jsx(p,{value:"6h",children:"Last 6 Hours"}),e.jsx(p,{value:"24h",children:"Last 24 Hours"}),e.jsx(p,{value:"7d",children:"Last 7 Days"}),e.jsx(p,{value:"30d",children:"Last 30 Days"})]})]}),e.jsx(X,{variant:"outlined",startIcon:e.jsx(se,{}),onClick:m,children:"Refresh"}),e.jsx(X,{variant:"outlined",color:"error",startIcon:e.jsx(ne,{}),onClick:V,children:"Clear Data"})]})]}),e.jsxs(D,{container:!0,spacing:3,sx:{marginBottom:4},children:[e.jsx(D,{item:!0,xs:12,sm:6,md:3,children:e.jsx(I,{children:e.jsxs(E,{children:[e.jsxs(d,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between"},children:[e.jsxs(d,{children:[e.jsx(c,{color:"textSecondary",gutterBottom:!0,children:"Total Errors"}),e.jsx(c,{variant:"h4",children:o.errorCount})]}),e.jsx(ae,{sx:{fontSize:40,color:"error.main"}})]}),o.criticalErrors>0&&e.jsxs(k,{severity:"error",sx:{marginTop:1},children:[o.criticalErrors," critical errors detected!"]})]})})}),e.jsx(D,{item:!0,xs:12,sm:6,md:3,children:e.jsx(I,{children:e.jsx(E,{children:e.jsxs(d,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between"},children:[e.jsxs(d,{children:[e.jsx(c,{color:"textSecondary",gutterBottom:!0,children:"Avg Page Load"}),e.jsxs(c,{variant:"h4",children:[Math.round(o.avgPerformance),"ms"]}),e.jsx(c,{variant:"body2",sx:{color:z(o.avgPerformance).color},children:z(o.avgPerformance).rating})]}),e.jsx(ie,{sx:{fontSize:40,color:"primary.main"}})]})})})}),e.jsx(D,{item:!0,xs:12,sm:6,md:3,children:e.jsx(I,{children:e.jsx(E,{children:e.jsxs(d,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between"},children:[e.jsxs(d,{children:[e.jsx(c,{color:"textSecondary",gutterBottom:!0,children:"Active Sessions"}),e.jsx(c,{variant:"h4",children:o.sessionCount})]}),e.jsx(ce,{sx:{fontSize:40,color:"success.main"}})]})})})}),e.jsx(D,{item:!0,xs:12,sm:6,md:3,children:e.jsx(I,{children:e.jsx(E,{children:e.jsxs(d,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between"},children:[e.jsxs(d,{children:[e.jsx(c,{color:"textSecondary",gutterBottom:!0,children:"Events Tracked"}),e.jsx(c,{variant:"h4",children:r.length})]}),e.jsx(oe,{sx:{fontSize:40,color:"info.main"}})]})})})})]}),e.jsxs(D,{container:!0,spacing:3,children:[e.jsx(D,{item:!0,xs:12,lg:8,children:e.jsxs(N,{sx:{padding:3},children:[e.jsx(c,{variant:"h6",gutterBottom:!0,children:"Recent Errors"}),s.length===0?e.jsx(k,{severity:"success",children:"No errors detected in the selected time range."}):e.jsx(le,{children:e.jsxs(de,{children:[e.jsx(ue,{children:e.jsxs(_,{children:[e.jsx(v,{children:"Severity"}),e.jsx(v,{children:"Message"}),e.jsx(v,{children:"Time"}),e.jsx(v,{children:"Actions"})]})}),e.jsx(he,{children:s.slice(0,10).map(n=>e.jsxs(_,{children:[e.jsx(v,{children:e.jsx(Y,{label:n.severity.toUpperCase(),color:J(n.severity),size:"small"})}),e.jsx(v,{children:e.jsxs(c,{variant:"body2",sx:{maxWidth:300},children:[n.message.substring(0,100),n.message.length>100?"...":""]})}),e.jsx(v,{children:e.jsx(c,{variant:"body2",children:W(new Date(n.timestamp),{addSuffix:!0})})}),e.jsx(v,{children:e.jsx(me,{title:"View Details",children:e.jsx(xe,{size:"small",onClick:()=>j(n),children:e.jsx(fe,{})})})})]},n.id))})]})})]})}),e.jsx(D,{item:!0,xs:12,lg:4,children:e.jsxs(N,{sx:{padding:3},children:[e.jsx(c,{variant:"h6",gutterBottom:!0,children:"Performance Metrics"}),t.length===0?e.jsx(k,{severity:"info",children:"No performance data available."}):e.jsx(d,{children:t.slice(0,5).map(n=>{const T=z(n.metrics.pageLoadTime);return e.jsxs(d,{sx:{marginBottom:2},children:[e.jsxs(d,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsxs(c,{variant:"body2",children:["Load Time: ",Math.round(n.metrics.pageLoadTime),"ms"]}),e.jsx(Y,{label:T.rating,size:"small",sx:{backgroundColor:T.color,color:"white"}})]}),e.jsx(ge,{variant:"determinate",value:Math.min(n.metrics.pageLoadTime/5e3*100,100),sx:{marginTop:.5}}),e.jsx(c,{variant:"caption",color:"textSecondary",children:W(new Date(n.timestamp),{addSuffix:!0})})]},n.id)})})]})})]}),l&&e.jsxs(N,{sx:{position:"fixed",top:"50%",left:"50%",transform:"translate(-50%, -50%)",width:"80%",maxWidth:800,maxHeight:"80%",overflow:"auto",padding:3,zIndex:1300},children:[e.jsxs(d,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:2},children:[e.jsx(c,{variant:"h6",children:"Error Details"}),e.jsx(X,{onClick:()=>j(null),children:"Close"})]}),e.jsx(c,{variant:"body2",component:"pre",sx:{backgroundColor:"grey.100",padding:2,borderRadius:1,fontSize:"0.8rem",whiteSpace:"pre-wrap",wordBreak:"break-word"},children:JSON.stringify(l,null,2)})]})]})};export{ke as default};
