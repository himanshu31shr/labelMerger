import{j as e,B as c,Q as K,R as w,ar as U,ah as q,c as Q,aB as X,ax as N,U as G,a6 as S,C as A,I as J,aF as Y,z as Z,X as ee,r as te,b as E,D as se}from"./mui-vendor-tGclxw8b.js";import{a as n,b as ae}from"./react-vendor-DYr15v6v.js";import{u as B,C as re,e as oe,a as k,p as ne,s as ie,f as le,q as ce,t as de,v as ue,w as me}from"./index-Cb91SdTK.js";import{P as fe,a as pe}from"./ProductTableToolbar-DPibuSKQ.js";import{D as xe}from"./DataTable-DEz7wYai.js";import{F as C}from"./FormattedCurrency-BQf40NSG.js";import{V as he,a as ge}from"./ActionButtons-D6QB-2Vj.js";import"./redux-vendor-CLOwJCHO.js";import"./firebase-vendor-yCdHbQaA.js";import"./utils-vendor-CFocuF-S.js";import"./pdf-vendor-BVWGQTu2.js";const be=({onImport:r})=>{const[u,d]=n.useState(null),[h,m]=n.useState(!1),f=async i=>{var p;const l=(p=i.target.files)==null?void 0:p[0];if(l){if(!l.name.endsWith(".xlsx")&&!l.name.endsWith(".xls")&&!l.name.endsWith(".txt")){d("Please upload an Excel file (.xlsx or .xls)");return}try{d(null),await r(l,h)}catch{d("Failed to import products. Please check the file format.")}i.target.value=""}};return e.jsxs(c,{sx:{display:"flex",flexDirection:"column",alignItems:"flex-end",gap:1},children:[e.jsxs(c,{sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsx(K,{control:e.jsx(w,{checked:h,onChange:i=>m(i.target.checked),size:"small"}),label:"Update existing products",sx:{mr:2}}),e.jsx(U,{title:"When checked, existing products will be updated with new prices and metadata from the import file. User customizations (cost price, categories, visibility) will be preserved.",children:e.jsx(q,{sx:{fontSize:20,color:"text.secondary",cursor:"help"}})})]}),e.jsxs(Q,{variant:"contained",component:"label",startIcon:e.jsx(X,{}),children:["Import Products",e.jsx("input",{type:"file",hidden:!0,accept:".xlsx,.xls,.txt",onChange:f})]}),e.jsx(N,{open:!!u,autoHideDuration:6e3,onClose:()=>d(null),message:u})]})},ye=({products:r,allProducts:u,onEdit:d,onFilterChange:h,onBulkCategoryUpdate:m})=>{const f=B(),[i,l]=n.useState([]),[p,g]=n.useState({}),[b,o]=n.useState(!1),[x,y]=n.useState(""),[D,$]=n.useState("success"),[W,R]=n.useState({}),[T,v]=n.useState(!1),I=n.useMemo(()=>new re,[]);n.useEffect(()=>{f(oe())},[f]),n.useEffect(()=>{const t=async()=>{v(!0);try{const s=await I.initializeCostPrices(r),a={};s.forEach((z,H)=>{a[H]={value:z.value,source:z.source}}),R(a)}catch(s){console.error("Error fetching cost prices:",s),y("Failed to fetch cost prices"),$("error"),o(!0)}finally{v(!1)}};r.length>0&&t()},[r,I]);const j=k(ne),M=t=>{g(t),h(t)},L=t=>{l(s=>s.includes(t)?s.filter(a=>a!==t):[...s,t])},O=async(t,s)=>{if(m)try{await m(t,s),l([]);const a=P(s);y(`Successfully assigned ${t.length} product(s) to category "${a}"`),o(!0)}catch{y("Failed to assign category to products"),o(!0)}},F=()=>{o(!1)},P=t=>{if(!t||!Array.isArray(j))return"-";const s=j.find(a=>a.id===t);return s?s.name:"-"},V=[{id:"select",label:"",format:(t,s)=>s?e.jsx(w,{checked:i.includes(s.sku),onChange:()=>L(s.sku)}):null},{id:"sku",label:"SKU",filter:!0},{id:"name",label:"Name",filter:!0},{id:"categoryId",label:"Category",filter:!0,format:t=>e.jsx(S,{label:P(t),size:"small"}),filterValue:t=>P(t.categoryId)},{id:"platform",label:"Platform",format:t=>{const s=t;return e.jsx(S,{label:s.toUpperCase(),color:t==="amazon"?"default":"primary"})},filter:!0},{id:"costPrice",label:"Cost Price",align:"right",format:(t,s)=>{if(!(s!=null&&s.sku))return console.log("No SKU found for row:",s),null;if(T)return e.jsx(A,{size:20});const a=W[s.sku];return console.log(`Cost price info for ${s.sku}:`,a),!a||typeof a.value!="number"?(console.log(`No valid cost price found for ${s.sku}`),e.jsx(C,{value:0})):e.jsx(U,{title:`Cost price ${a.value} (from ${a.source})`,children:e.jsx(c,{children:e.jsx(C,{value:a.value})})})}},{id:"sellingPrice",label:"Selling Price",align:"right",format:t=>e.jsx(C,{value:t})},{id:"actions",label:"Actions",align:"center",format:(t,s)=>_(s)}],_=t=>{var s,a;return e.jsxs(e.Fragment,{children:[e.jsx(J,{size:"small","aria-label":`edit-${t.sku}`,onClick:()=>d(t),children:e.jsx(Y,{})}),((s=t.metadata)==null?void 0:s.flipkartSerialNumber)&&e.jsx(he,{flipkartSerialNumber:t.metadata.flipkartSerialNumber}),((a=t.metadata)==null?void 0:a.amazonSerialNumber)&&e.jsx(ge,{amazonSerialNumber:t.metadata.amazonSerialNumber})]})};return e.jsxs(c,{sx:{width:"100%"},children:[e.jsx(fe,{platform:p.platform,search:p.search,selectedProducts:i,categories:j,allProducts:u||r,onFilterChange:M,onBulkCategoryUpdate:O}),e.jsx(xe,{columns:V,data:r,defaultSortColumn:"sku",defaultSortDirection:"asc",rowsPerPageOptions:[10,25,50],defaultRowsPerPage:10}),e.jsx(N,{open:b,autoHideDuration:6e3,onClose:F,anchorOrigin:{vertical:"bottom",horizontal:"right"},children:e.jsx(G,{onClose:F,severity:D,sx:{width:"100%"},children:x})})]})},Ue=()=>{const r=B(),{items:u,filteredItems:d,loading:h}=k(o=>o.products),m=k(ie),[f,i]=ae.useState(null);n.useEffect(()=>{m&&r(le({}))},[r,m]);const l=async(o,x)=>{try{await r(ce({file:o,updateExisting:x})).unwrap()}catch{}},p=async(o,x)=>{try{await r(me({sku:o,data:x})).unwrap(),i(null)}catch{}},g=async(o,x)=>{try{await r(de({skus:o,data:{categoryId:x}})).unwrap()}catch{}},b=o=>{r(ue(o))};return e.jsx(Z,{maxWidth:"xl",sx:{py:3},children:e.jsxs(ee,{sx:{p:3,mb:4,borderRadius:2},children:[e.jsxs(c,{sx:{display:"flex",alignItems:"center",mb:3,justifyContent:"space-between"},children:[e.jsxs(c,{sx:{display:"flex",alignItems:"center",mb:3},children:[e.jsx(te,{sx:{fontSize:32,mr:2,color:"primary.main"}}),e.jsx(E,{variant:"h4",component:"h1",sx:{fontWeight:"bold",color:"primary.dark"},children:"Product Management"}),e.jsx(S,{label:`${u.length} Products`,color:"primary",size:"medium",sx:{ml:2}})]}),e.jsx(be,{onImport:l})]}),e.jsx(se,{sx:{mb:3}}),e.jsx(c,{sx:{width:"100%"},children:h?e.jsx(c,{display:"flex",justifyContent:"center",alignItems:"center",m:4,children:e.jsx(A,{color:"primary",size:40,thickness:4})}):e.jsxs(c,{children:[e.jsx(E,{variant:"h6",sx:{mb:2,fontWeight:"bold",color:"primary.dark"},children:"Product Catalog"}),e.jsx(ye,{products:d,allProducts:u,onEdit:i,onFilterChange:b,onBulkCategoryUpdate:g})]})}),f&&e.jsx(pe,{product:f,onClose:()=>i(null),onSave:p})]})})};export{Ue as ProductsPage,Ue as default};
