import{j as e,ab as te,ac as se,B as i,W as re,b as n,ae as ne,an as $,a9 as T,a6 as b,U as v,aj as oe,c as G,G as z,al as M,C as Y,w as N,a1 as f,u as ae,z as le,bv as ie,k as R,bw as ce,bx as de,I as w,aQ as xe,aR as U,at as L,aa as he,ax as ue}from"./mui-vendor-tGclxw8b.js";import{a as l}from"./react-vendor-DYr15v6v.js";import{p as y}from"./pdfStorageService-CLDArnMX.js";import"./firebase-vendor-yCdHbQaA.js";import"./index-Cb91SdTK.js";import"./redux-vendor-CLOwJCHO.js";import"./utils-vendor-CFocuF-S.js";import"./pdf-vendor-BVWGQTu2.js";const me=s=>{if(s===0)return"0 Bytes";const r=1024,c=["Bytes","KB","MB","GB"],o=Math.floor(Math.log(s)/Math.log(r));return parseFloat((s/Math.pow(r,o)).toFixed(2))+" "+c[o]},fe=({open:s,onClose:r,onConfirm:c,itemType:o,itemName:u,folderStats:a})=>{const m=o==="folder",x=a&&a.fileCount>1;return e.jsxs(te,{open:s,onClose:r,maxWidth:"sm",fullWidth:!0,"aria-labelledby":"delete-dialog-title",children:[e.jsx(se,{id:"delete-dialog-title",children:e.jsxs(i,{sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsx(re,{color:"warning"}),e.jsxs(n,{variant:"h6",children:["Delete ",m?"Folder":"File"]})]})}),e.jsxs(ne,{children:[e.jsxs(i,{sx:{display:"flex",alignItems:"center",gap:2,mb:2},children:[m?e.jsx($,{color:"primary",sx:{fontSize:40}}):e.jsx(T,{color:"error",sx:{fontSize:40}}),e.jsxs(i,{children:[e.jsx(n,{variant:"h6",component:"div",sx:{wordBreak:"break-word"},children:u}),a&&e.jsxs(i,{sx:{display:"flex",gap:1,mt:1},children:[e.jsx(b,{label:`${a.fileCount} file${a.fileCount!==1?"s":""}`,size:"small",variant:"outlined"}),e.jsx(b,{label:me(a.totalSize),size:"small",variant:"outlined"})]})]})]}),e.jsx(v,{severity:"warning",sx:{mb:2},children:e.jsx(n,{variant:"body2",children:m?e.jsxs(e.Fragment,{children:["This will permanently delete the folder and"," ",e.jsx("strong",{children:a?`all ${a.fileCount} file${a.fileCount!==1?"s":""}`:"all files"})," ","inside it."]}):"This will permanently delete the file."})}),x&&e.jsx(v,{severity:"error",sx:{mb:2},children:e.jsxs(n,{variant:"body2",fontWeight:"bold",children:["⚠️ This folder contains ",a==null?void 0:a.fileCount," files. This action cannot be undone!"]})}),e.jsx(n,{variant:"body2",color:"text.secondary",children:"Are you sure you want to continue? This action cannot be undone."})]}),e.jsxs(oe,{sx:{p:2},children:[e.jsx(G,{onClick:r,variant:"outlined",children:"Cancel"}),e.jsxs(G,{onClick:c,variant:"contained",color:"error",autoFocus:!0,children:["Delete ",m?"Folder":"File"]})]})]})},je=s=>{if(s===0)return"0 Bytes";const r=1024,c=["Bytes","KB","MB","GB"],o=Math.floor(Math.log(s)/Math.log(r));return parseFloat((s/Math.pow(r,o)).toFixed(2))+" "+c[o]},pe=()=>{const[s,r]=l.useState(null),[c,o]=l.useState(!0),[u,a]=l.useState(null),m=async()=>{try{o(!0),a(null);const x=await y.listUserFolders();let j=0,p=0;for(const g of x)j+=g.fileCount,p+=g.totalSize;r({totalFolders:x.length,totalFiles:j,totalSize:p})}catch(x){const j=x instanceof Error?x.message:"Failed to load storage statistics";a(j),console.error("Error loading storage stats:",x)}finally{o(!1)}};return l.useEffect(()=>{m()},[]),c?e.jsx(z,{children:e.jsx(M,{children:e.jsx(i,{sx:{display:"flex",justifyContent:"center",py:2},children:e.jsx(Y,{size:24})})})}):u?e.jsxs(v,{severity:"error",children:["Failed to load storage statistics: ",u]}):s?e.jsx(z,{children:e.jsxs(M,{children:[e.jsxs(n,{variant:"h6",gutterBottom:!0,sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsx(N,{color:"primary"}),"Storage Overview"]}),e.jsxs(f,{container:!0,spacing:2,children:[e.jsx(f,{item:!0,xs:12,sm:4,children:e.jsxs(i,{sx:{textAlign:"center"},children:[e.jsx($,{color:"primary",sx:{fontSize:40,mb:1}}),e.jsx(n,{variant:"h4",component:"div",children:s.totalFolders}),e.jsxs(n,{variant:"body2",color:"text.secondary",children:["Folder",s.totalFolders!==1?"s":""]})]})}),e.jsx(f,{item:!0,xs:12,sm:4,children:e.jsxs(i,{sx:{textAlign:"center"},children:[e.jsx(T,{color:"error",sx:{fontSize:40,mb:1}}),e.jsx(n,{variant:"h4",component:"div",children:s.totalFiles}),e.jsxs(n,{variant:"body2",color:"text.secondary",children:["File",s.totalFiles!==1?"s":""]})]})}),e.jsx(f,{item:!0,xs:12,sm:4,children:e.jsxs(i,{sx:{textAlign:"center"},children:[e.jsx(N,{color:"success",sx:{fontSize:40,mb:1}}),e.jsx(n,{variant:"h4",component:"div",children:je(s.totalSize)}),e.jsx(n,{variant:"body2",color:"text.secondary",children:"Total Size"})]})})]}),s.totalFiles===0&&e.jsx(i,{sx:{mt:2,textAlign:"center"},children:e.jsx(b,{label:"No files uploaded yet",variant:"outlined",color:"default"})})]})}):null},H=s=>{if(s===0)return"0 Bytes";const r=1024,c=["Bytes","KB","MB","GB"],o=Math.floor(Math.log(s)/Math.log(r));return parseFloat((s/Math.pow(r,o)).toFixed(2))+" "+c[o]},K=s=>{const c=Math.floor((new Date().getTime()-s.getTime())/(1e3*60));if(c<1)return"Just now";if(c<60)return`${c}m ago`;const o=Math.floor(c/60);if(o<24)return`${o}h ago`;const u=Math.floor(o/24);return u<7?`${u}d ago`:s.toLocaleDateString()},ze=()=>{const s=ae(),[r,c]=l.useState(""),[o,u]=l.useState([]),[a,m]=l.useState([]),[x,j]=l.useState([]),[p,g]=l.useState(!0),[A,F]=l.useState(null),[J,B]=l.useState(!1),[d,k]=l.useState(null),[Q,C]=l.useState(!1),[_,D]=l.useState(""),[q,W]=l.useState("success"),I=async()=>{try{if(g(!0),F(null),r===""){const t=await y.listUserFolders();m(t),j([])}else{const t=await y.listFolderContents(r);j(t),m([])}}catch(t){const h=t instanceof Error?t.message:"Failed to load storage contents";F(h),console.error("Error loading storage contents:",t)}finally{g(!1)}},V=()=>{if(r===""){u([]);return}const t=r.split("/").filter(Boolean),h=[];let P="";for(let S=2;S<t.length;S++)P+=(P?"/":"")+t[S],h.push({name:t[S],path:`pdfs/${t[1]}/${P}`});u(h)},E=t=>{c(t)},X=t=>{E(t.path)},O=(t,h)=>{k({type:t,item:h}),B(!0)},Z=async()=>{if(d)try{g(!0),d.type==="folder"?(await y.deleteFolderRecursive(d.item.path),D("Folder deleted successfully")):(await y.deleteFile(d.item.path),D("File deleted successfully")),W("success"),C(!0),await I()}catch(t){const h=t instanceof Error?t.message:"Failed to delete item";F(h),D(h),W("error"),C(!0)}finally{g(!1),B(!1),k(null)}},ee=t=>{window.open(t.downloadUrl,"_blank")};return l.useEffect(()=>{I()},[r]),l.useEffect(()=>{V()},[r]),e.jsxs(le,{maxWidth:"lg",sx:{py:3},children:[e.jsxs(i,{sx:{mb:3},children:[e.jsx(n,{variant:"h4",component:"h1",gutterBottom:!0,children:"Storage Management"}),e.jsx(n,{variant:"body1",color:"text.secondary",children:"Manage your uploaded PDF files and folders"})]}),e.jsx(i,{sx:{mb:3},children:e.jsx(pe,{})}),e.jsx(i,{sx:{mb:3},children:e.jsxs(ie,{separator:e.jsx(de,{fontSize:"small"}),"aria-label":"folder navigation",children:[e.jsxs(R,{component:"button",variant:"body1",onClick:()=>E(""),sx:{display:"flex",alignItems:"center",textDecoration:"none","&:hover":{textDecoration:"underline"}},children:[e.jsx(ce,{sx:{mr:.5},fontSize:"inherit"}),"My Files"]}),o.map(t=>e.jsx(R,{component:"button",variant:"body1",onClick:()=>E(t.path),sx:{textDecoration:"none","&:hover":{textDecoration:"underline"}},children:t.name},t.path))]})}),e.jsx(i,{sx:{mb:3,display:"flex",justifyContent:"flex-end"},children:e.jsx(w,{onClick:I,disabled:p,"aria-label":"refresh",color:"primary",children:e.jsx(xe,{})})}),A&&e.jsx(v,{severity:"error",sx:{mb:3},onClose:()=>F(null),children:A}),p&&e.jsx(i,{sx:{display:"flex",justifyContent:"center",py:4},children:e.jsx(Y,{})}),!p&&e.jsxs(f,{container:!0,spacing:2,children:[a.map(t=>e.jsx(f,{item:!0,xs:12,sm:6,md:4,lg:3,children:e.jsxs(z,{sx:{cursor:"pointer",transition:"all 0.2s","&:hover":{transform:"translateY(-2px)",boxShadow:s.shadows[4]}},children:[e.jsxs(M,{onClick:()=>X(t),sx:{pb:1},children:[e.jsxs(i,{sx:{display:"flex",alignItems:"center",mb:1},children:[e.jsx($,{color:"primary",sx:{mr:1,fontSize:32}}),e.jsx(n,{variant:"h6",component:"div",noWrap:!0,children:t.name})]}),e.jsxs(n,{variant:"body2",color:"text.secondary",gutterBottom:!0,children:[t.fileCount," file",t.fileCount!==1?"s":""]}),e.jsx(n,{variant:"body2",color:"text.secondary",children:H(t.totalSize)}),e.jsx(b,{label:K(t.lastModified),size:"small",sx:{mt:1}})]}),e.jsx(U,{sx:{pt:0},children:e.jsx(w,{size:"small",color:"error",onClick:h=>{h.stopPropagation(),O("folder",t)},"aria-label":"delete folder",children:e.jsx(L,{})})})]})},t.path)),x.map(t=>e.jsx(f,{item:!0,xs:12,sm:6,md:4,lg:3,children:e.jsxs(z,{sx:{transition:"all 0.2s","&:hover":{transform:"translateY(-2px)",boxShadow:s.shadows[4]}},children:[e.jsxs(M,{sx:{pb:1},children:[e.jsxs(i,{sx:{display:"flex",alignItems:"center",mb:1},children:[e.jsx(T,{color:"error",sx:{mr:1,fontSize:32}}),e.jsx(n,{variant:"h6",component:"div",noWrap:!0,title:t.name,children:t.name})]}),e.jsx(n,{variant:"body2",color:"text.secondary",gutterBottom:!0,children:H(t.size)}),e.jsx(b,{label:K(t.lastModified),size:"small",sx:{mt:1}})]}),e.jsxs(U,{sx:{pt:0,justifyContent:"space-between"},children:[e.jsx(w,{size:"small",color:"primary",onClick:()=>ee(t),"aria-label":"download file",children:e.jsx(he,{})}),e.jsx(w,{size:"small",color:"error",onClick:()=>O("file",t),"aria-label":"delete file",children:e.jsx(L,{})})]})]})},t.path)),!p&&a.length===0&&x.length===0&&e.jsx(f,{item:!0,xs:12,children:e.jsxs(i,{sx:{textAlign:"center",py:8,color:"text.secondary"},children:[e.jsx(n,{variant:"h6",gutterBottom:!0,children:"No files or folders found"}),e.jsx(n,{variant:"body2",children:"Upload some PDF files to get started with storage management."})]})})]}),e.jsx(fe,{open:J,onClose:()=>{B(!1),k(null)},onConfirm:Z,itemType:(d==null?void 0:d.type)||"file",itemName:(d==null?void 0:d.item.name)||"",folderStats:(d==null?void 0:d.type)==="folder"?{fileCount:d.item.fileCount,totalSize:d.item.totalSize}:void 0}),e.jsx(ue,{open:Q,autoHideDuration:6e3,onClose:()=>C(!1),children:e.jsx(v,{onClose:()=>C(!1),severity:q,sx:{width:"100%"},children:_})})]})};export{ze as StorageManagementPage};
