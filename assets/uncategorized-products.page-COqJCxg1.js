import{j as e,B as c,ax as W,U as F,R as M,a6 as y,ar as $,I as O,aF as V,z as _,X as q,W as L,b as f,a8 as G,D as H,C as K,v as X}from"./mui-vendor-tGclxw8b.js";import{a as n,b as A}from"./react-vendor-DYr15v6v.js";import{u as I,C as Y,e as J,a as C,p as Q,s as Z,f as ee,t as te,v as se,w as ae}from"./index-Cb91SdTK.js";import{P as re,a as oe}from"./ProductTableToolbar-DPibuSKQ.js";import{D as ne}from"./DataTable-DEz7wYai.js";import{F as v}from"./FormattedCurrency-BQf40NSG.js";import{V as ie,a as ce}from"./ActionButtons-D6QB-2Vj.js";import"./redux-vendor-CLOwJCHO.js";import"./firebase-vendor-yCdHbQaA.js";import"./utils-vendor-CFocuF-S.js";import"./pdf-vendor-BVWGQTu2.js";const le=({products:o,onEdit:g,onFilterChange:p,onBulkCategoryUpdate:d})=>{const u=I(),[l,i]=n.useState([]),[h,b]=n.useState({}),[P,a]=n.useState(!1),[m,k]=n.useState(""),[S,U]=n.useState({}),z=n.useMemo(()=>new Y,[]);n.useEffect(()=>{u(J())},[u]),n.useEffect(()=>{(async()=>{const t={};for(const r of o){const x=await z.getProductCostPrice(r.sku);t[r.sku]={value:x.value,source:x.source}}U(t)})()},[o,z]);const j=C(Q),N=s=>{b(s),p(s)},E=s=>{i(t=>t.includes(s)?t.filter(r=>r!==s):[...t,s])},B=async(s,t)=>{if(d)try{await d(s,t),i([]);const r=D(t);k(`Successfully assigned ${s.length} product(s) to category "${r}"`),a(!0)}catch{k("Failed to assign category to products"),a(!0)}},w=()=>{a(!1)},D=s=>{if(!s||!Array.isArray(j))return"-";const t=j.find(r=>r.id===s);return t?t.name:"-"},R=[{id:"select",label:"",format:(s,t)=>t?e.jsx(M,{checked:l.includes(t.sku),onChange:()=>E(t.sku)}):null},{id:"sku",label:"SKU",filter:!0},{id:"name",label:"Name",filter:!0},{id:"categoryId",label:"Category",format:()=>e.jsx(y,{label:"No Category",color:"warning",size:"small"})},{id:"platform",label:"Platform",format:s=>{const t=s;return e.jsx(y,{label:t.toUpperCase(),color:s==="amazon"?"default":"primary"})},filter:!0},{id:"costPrice",label:"Cost Price",align:"right",format:(s,t)=>{if(!(t!=null&&t.sku)||!S[t.sku])return null;const{value:r,source:x}=S[t.sku];return e.jsx($,{title:`Inherited from ${x}`,children:e.jsx(c,{children:e.jsx(v,{value:r})})})}},{id:"sellingPrice",label:"Selling Price",align:"right",format:s=>e.jsx(v,{value:s})},{id:"actions",label:"Actions",align:"center",format:(s,t)=>T(t)}],T=s=>{var t,r;return e.jsxs(e.Fragment,{children:[e.jsx(O,{size:"small","aria-label":`edit-${s.sku}`,onClick:()=>g(s),children:e.jsx(V,{})}),((t=s.metadata)==null?void 0:t.flipkartSerialNumber)&&e.jsx(ie,{flipkartSerialNumber:s.metadata.flipkartSerialNumber}),((r=s.metadata)==null?void 0:r.amazonSerialNumber)&&e.jsx(ce,{amazonSerialNumber:s.metadata.amazonSerialNumber})]})};return e.jsxs(c,{sx:{width:"100%"},children:[e.jsx(re,{platform:h.platform,search:h.search,selectedProducts:l,categories:j,allProducts:o,onFilterChange:N,onBulkCategoryUpdate:B}),e.jsx(ne,{columns:R,data:o,defaultSortColumn:"sku",defaultSortDirection:"asc",rowsPerPageOptions:[10,25,50],defaultRowsPerPage:10}),e.jsx(W,{open:P,autoHideDuration:6e3,onClose:w,anchorOrigin:{vertical:"bottom",horizontal:"right"},children:e.jsx(F,{onClose:w,severity:"success",sx:{width:"100%"},children:m})})]})},ye=()=>{const o=I(),{items:g,loading:p}=C(a=>a.products),d=C(Z),[u,l]=A.useState(null),i=A.useMemo(()=>g.filter(a=>!a.categoryId||a.categoryId.trim()===""),[g]);n.useEffect(()=>{d&&o(ee({}))},[o,d]);const h=async(a,m)=>{try{await o(ae({sku:a,data:m})).unwrap(),l(null)}catch{}},b=async(a,m)=>{try{await o(te({skus:a,data:{categoryId:m}})).unwrap()}catch{}},P=a=>{o(se(a))};return e.jsx(_,{maxWidth:"xl",sx:{py:3},children:e.jsxs(q,{sx:{p:3,mb:4,borderRadius:2},children:[e.jsx(c,{sx:{display:"flex",alignItems:"center",mb:3,justifyContent:"space-between"},children:e.jsxs(c,{sx:{display:"flex",alignItems:"center",mb:3},children:[e.jsx(L,{sx:{fontSize:32,mr:2,color:"warning.main"}}),e.jsx(f,{variant:"h4",component:"h1",sx:{fontWeight:"bold",color:"warning.dark"},children:"Uncategorized Products"}),e.jsx(y,{label:`${i.length} Products`,color:"warning",size:"medium",sx:{ml:2}})]})}),"        ",i.length>0&&e.jsxs(F,{severity:"warning",sx:{mb:3},children:[e.jsx(G,{children:"Action Required"}),"You have ",i.length," product(s) without categories. Products without categories may not appear in reports and analytics correctly. Please assign categories to these products for better organization and tracking."]}),e.jsx(H,{sx:{mb:3}}),e.jsx(c,{sx:{width:"100%"},children:p?e.jsx(c,{display:"flex",justifyContent:"center",alignItems:"center",m:4,children:e.jsx(K,{color:"warning",size:40,thickness:4})}):i.length===0?e.jsxs(c,{display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",py:8,children:[e.jsx(X,{sx:{fontSize:64,color:"success.main",mb:2}}),e.jsx(f,{variant:"h5",sx:{fontWeight:"bold",color:"success.dark",mb:1},children:"All Products Categorized!"}),e.jsx(f,{variant:"body1",color:"text.secondary",textAlign:"center",children:"Great job! All your products have been assigned to categories. This helps with better organization and reporting."})]}):e.jsxs(c,{children:[e.jsx(f,{variant:"h6",sx:{mb:2,fontWeight:"bold",color:"warning.dark"},children:"Products Requiring Category Assignment"}),e.jsx(le,{products:i,onEdit:l,onFilterChange:P,onBulkCategoryUpdate:b})]})}),u&&e.jsx(oe,{product:u,onClose:()=>l(null),onSave:h})]})})};export{ye as UncategorizedProductsPage,ye as default};
